<!doctype html>
<html lang="en-US">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.26" />
    <style>
      :root {
        --vp-c-bg: #fff;
      }

      [data-theme='dark'] {
        --vp-c-bg: #1b1b1f;
      }

      html,
      body {
        background-color: var(--vp-c-bg);
      }
    </style>
    <script>
      const useChoice = localStorage.getItem('vuepress-color-scheme')
      const systemStatus =
        'matchMedia' in window
          ? window.matchMedia('(prefers-color-scheme: dark)').matches
          : false

      if (useChoice === 'light') {
        document.documentElement.dataset.theme = 'light'
      } else if (useChoice === 'dark' || systemStatus) {
        document.documentElement.dataset.theme = 'dark'
      }
    </script>
    <title>dev-conf | 前端笔记</title><meta name="description" content="">
    <link rel="preload" href="/assets/style-C5QREZ3P.css" as="style"><link rel="stylesheet" href="/assets/style-C5QREZ3P.css">
    <link rel="modulepreload" href="/assets/app-34Y0emjC.js"><link rel="modulepreload" href="/assets/webpack-dev-conf.html-DkES_XNc.js">
    <link rel="prefetch" href="/assets/index.html-UaGxkCy4.js" as="script"><link rel="prefetch" href="/assets/flutter.html-DBHjzBLe.js" as="script"><link rel="prefetch" href="/assets/javascript.html-DtPrlpBO.js" as="script"><link rel="prefetch" href="/assets/loginNginx.html-BQ_QAgiu.js" as="script"><link rel="prefetch" href="/assets/mysql.html-DLJBs6ND.js" as="script"><link rel="prefetch" href="/assets/nginx.html-Bf4Szspc.js" as="script"><link rel="prefetch" href="/assets/node.html-BtGyUcc_.js" as="script"><link rel="prefetch" href="/assets/react.html-CZUjMelg.js" as="script"><link rel="prefetch" href="/assets/server.html-CKSiTZ-i.js" as="script"><link rel="prefetch" href="/assets/gulp.html-BeGu4zSE.js" as="script"><link rel="prefetch" href="/assets/npm.html-Cs6kthBG.js" as="script"><link rel="prefetch" href="/assets/vite.html-BP03Ysy1.js" as="script"><link rel="prefetch" href="/assets/webpack.html-1iyKbErE.js" as="script"><link rel="prefetch" href="/assets/brew.html-Whlmy9Ct.js" as="script"><link rel="prefetch" href="/assets/git.html-s6fegLLk.js" as="script"><link rel="prefetch" href="/assets/node.html-B06GqquJ.js" as="script"><link rel="prefetch" href="/assets/nvm.html-9dwZSSgT.js" as="script"><link rel="prefetch" href="/assets/basejieshao.html-CnLq_SEo.js" as="script"><link rel="prefetch" href="/assets/sass.html-ByITuZ16.js" as="script"><link rel="prefetch" href="/assets/vue2.html-P2Z87HNR.js" as="script"><link rel="prefetch" href="/assets/vue2_project.html-CRo1M2rS.js" as="script"><link rel="prefetch" href="/assets/vue2_router.html-IE7zeUuf.js" as="script"><link rel="prefetch" href="/assets/vue2_vuex.html-CrigqrFO.js" as="script"><link rel="prefetch" href="/assets/vue3.html-CJJg9a7V.js" as="script"><link rel="prefetch" href="/assets/vue3_pinia.html-D92qVnmj.js" as="script"><link rel="prefetch" href="/assets/vue3_router.html-Bf9ce-8J.js" as="script"><link rel="prefetch" href="/assets/AjaxXML.html-QWCpUQbT.js" as="script"><link rel="prefetch" href="/assets/asyncawait.html-VbfBEwLi.js" as="script"><link rel="prefetch" href="/assets/crossOrigin.html-DnBaXCIJ.js" as="script"><link rel="prefetch" href="/assets/fetch.html-BCtLZJ5f.js" as="script"><link rel="prefetch" href="/assets/Generator.html-CC9DHNxy.js" as="script"><link rel="prefetch" href="/assets/packageUpload.html-hINW47kr.js" as="script"><link rel="prefetch" href="/assets/Promise.html-CDKHFcvi.js" as="script"><link rel="prefetch" href="/assets/console.html-DVuZPWdS.js" as="script"><link rel="prefetch" href="/assets/history.html-g5OvMs_7.js" as="script"><link rel="prefetch" href="/assets/location.html-DSAis5c1.js" as="script"><link rel="prefetch" href="/assets/Navigator.html-Bl6r7gJw.js" as="script"><link rel="prefetch" href="/assets/window.html-B-Gw3LLq.js" as="script"><link rel="prefetch" href="/assets/anime.html-BXPhqQoi.js" as="script"><link rel="prefetch" href="/assets/baseEvent.html-BusDqyLd.js" as="script"><link rel="prefetch" href="/assets/DOM.html-3i_T_Rec.js" as="script"><link rel="prefetch" href="/assets/DOMNode.html-D1Pjun9h.js" as="script"><link rel="prefetch" href="/assets/domPosition.html-B8BIv8ew.js" as="script"><link rel="prefetch" href="/assets/highEvent.html-CTPlm-Ci.js" as="script"><link rel="prefetch" href="/assets/localStroge.html-BNFD7dtg.js" as="script"><link rel="prefetch" href="/assets/operaForm.html-BakD0dGg.js" as="script"><link rel="prefetch" href="/assets/phoneEvent.html-DAk99yvh.js" as="script"><link rel="prefetch" href="/assets/arr.html-BXe2_7Rw.js" as="script"><link rel="prefetch" href="/assets/debugError.html-n7qwBWBi.js" as="script"><link rel="prefetch" href="/assets/Map.html-DujIRI_x.js" as="script"><link rel="prefetch" href="/assets/phoneDebug.html-Cvdey6_G.js" as="script"><link rel="prefetch" href="/assets/processControl.html-CILWQjWl.js" as="script"><link rel="prefetch" href="/assets/Set.html-DM4g1Rs4.js" as="script"><link rel="prefetch" href="/assets/Symbol.html-DN1ywOfh.js" as="script"><link rel="prefetch" href="/assets/transferDataType.html-CMcyweP2.js" as="script"><link rel="prefetch" href="/assets/var_dateType.html-CKcyQWb9.js" as="script"><link rel="prefetch" href="/assets/yunsuanfu.html-m4hcOWGx.js" as="script"><link rel="prefetch" href="/assets/collect.html-DhBRhnpm.js" as="script"><link rel="prefetch" href="/assets/designMode.html-hHNbQqih.js" as="script"><link rel="prefetch" href="/assets/moduleDev.html-SyEWkbip.js" as="script"><link rel="prefetch" href="/assets/storage.html-DJ7S1tg3.js" as="script"><link rel="prefetch" href="/assets/strict.html-CMjYNo8b.js" as="script"><link rel="prefetch" href="/assets/suanfa.html-DbmHYGEq.js" as="script"><link rel="prefetch" href="/assets/webSocket.html-C1knZfJl.js" as="script"><link rel="prefetch" href="/assets/argument_return.html-Cols24q2.js" as="script"><link rel="prefetch" href="/assets/highfunc.html-CJKtZjlo.js" as="script"><link rel="prefetch" href="/assets/varfunc.html-DRQJyc0_.js" as="script"><link rel="prefetch" href="/assets/zuoyongyu.html-BAhTivP8.js" as="script"><link rel="prefetch" href="/assets/Array.html-DXH6Sg-e.js" as="script"><link rel="prefetch" href="/assets/Class.html-DYF2ELEM.js" as="script"><link rel="prefetch" href="/assets/Date.html-e33QwLCC.js" as="script"><link rel="prefetch" href="/assets/faceObjectCode.html-XH4_gkKg.js" as="script"><link rel="prefetch" href="/assets/Math.html-Gd6eyw66.js" as="script"><link rel="prefetch" href="/assets/Object.html-CPG5z0dn.js" as="script"><link rel="prefetch" href="/assets/objectbase.html-zQ9cFlqe.js" as="script"><link rel="prefetch" href="/assets/objectSpecial.html-2ivlXHua.js" as="script"><link rel="prefetch" href="/assets/reg.html-U4a5TWvn.js" as="script"><link rel="prefetch" href="/assets/String.html-CIWD1gWZ.js" as="script"><link rel="prefetch" href="/assets/404.html-lCt3-m2m.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><div class="vp-theme-container external-link-icon" vp-container><!--[--><header class="vp-navbar" vp-navbar><div class="vp-toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a class="route-link" href="/"><!----><span class="vp-site-name" aria-hidden="true">前端笔记</span></a></span><div class="vp-navbar-items-wrapper" style=""><!--[--><!--]--><!----><!--[--><!--]--><button type="button" class="vp-toggle-color-mode-button" title="toggle color mode"><svg class="light-icon" viewbox="0 0 32 32" style=""><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg class="dark-icon" viewbox="0 0 32 32" style="display:none;"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><!----></div></header><!--]--><div class="vp-sidebar-mask"></div><!--[--><aside class="vp-sidebar" vp-sidebar><!----><!--[--><!--]--><ul class="vp-sidebar-items"><!--[--><li><p tabindex="0" class="vp-sidebar-item vp-sidebar-heading">dev-conf <!----></p><!----></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="vp-page"><!--[--><!--]--><div vp-content><!--[--><!--]--><div id="content"><h1 id="dev-conf" tabindex="-1"><a class="header-anchor" href="#dev-conf"><span>dev-conf</span></a></h1><h2 id="获取当前打包模块的path" tabindex="-1"><a class="header-anchor" href="#获取当前打包模块的path"><span>获取当前打包模块的path</span></a></h2><ul><li>getCommand：获取终端执行命令的参数（--）要打包的模块</li><li>glob.sync：指定规则（&#39;./src/module/<em>/</em>.js&#39;）下的所有文件路径</li><li>getDirName：获取路径的 倒数第二个/ 和 倒数第一个/ 之间的字符串</li><li>path.extname(entry)这个文件路径的后缀</li><li>path.basename(entry, path.extname(entry)) 获取entry去除后缀的文件名</li><li>getEntry 依赖命令的参数模块名称，生成[{打包后的入口文件路径: [&quot;babel-polyfill&quot;, 当前模块入口文件路径]}]</li><li>babel-polyfill是用于 提供 ES6+ 新特性的浏览器兼容支持,为旧浏览器提供现代 JavaScript 特性,在全局环境中添加新的内置对象和方法</li><li>babel-polyfill是在业务代码前，将es的一些新特性，进行实现</li></ul><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">var</span> baseWebpackConfig <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;./webpack.base.conf&#39;</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">var</span> entries <span class="token operator">=</span> <span class="token function">getEntry</span><span class="token punctuation">(</span><span class="token string">&#39;./src/module/*/*.js&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 获得入口js文件</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">function</span> <span class="token function">getEntry</span><span class="token punctuation">(</span><span class="token parameter">globPath</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">var</span> entries <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">    basename<span class="token punctuation">,</span> tmp<span class="token punctuation">,</span> pathname<span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">var</span> commandDirName <span class="token operator">=</span> <span class="token function">getCommand</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//要打包的文件目录</span></span>
<span class="line">  glob<span class="token punctuation">.</span><span class="token function">sync</span><span class="token punctuation">(</span>globPath<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">entry</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">var</span> dirName <span class="token operator">=</span> <span class="token function">getDirName</span><span class="token punctuation">(</span>entry<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    basename <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">basename</span><span class="token punctuation">(</span>entry<span class="token punctuation">,</span> path<span class="token punctuation">.</span><span class="token function">extname</span><span class="token punctuation">(</span>entry<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">var</span> fileName<span class="token punctuation">;</span></span>
<span class="line">    fileName <span class="token operator">=</span> dirName <span class="token operator">+</span> <span class="token string">&#39;/js/&#39;</span> <span class="token operator">+</span> basename<span class="token punctuation">;</span> <span class="token comment">// 正确输出js和html的路径</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment">//判断该打包的是哪个文件夹</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>commandDirName<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> commandDirName<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token keyword">if</span> <span class="token punctuation">(</span>dirName <span class="token operator">==</span> commandDirName<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            entries<span class="token punctuation">[</span>fileName<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&quot;babel-polyfill&quot;</span><span class="token punctuation">,</span> entry<span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">        entries<span class="token punctuation">[</span>fileName<span class="token punctuation">]</span> <span class="token operator">=</span> entry<span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">return</span> entries<span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token keyword">function</span> <span class="token function">getCommand</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">var</span> allArr <span class="token operator">=</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span>npm_config_argv<span class="token punctuation">;</span></span>
<span class="line">  allArr <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>allArr<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">var</span> tempArr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">var</span> commandArr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> key <span class="token keyword">in</span> allArr<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>key <span class="token operator">==</span> <span class="token string">&#39;cooked&#39;</span> <span class="token operator">||</span> key <span class="token operator">==</span> <span class="token string">&#39;original&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">      tempArr <span class="token operator">=</span> allArr<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line">  nowBuild <span class="token operator">=</span> tempArr<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span></span>
<span class="line"></span>
<span class="line">  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> tempArr<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    commandArr<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>tempArr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">&#39;--&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line">  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> key <span class="token keyword">in</span> cmdInfo<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">contains</span><span class="token punctuation">(</span>commandArr<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token function">remove</span><span class="token punctuation">(</span>commandArr<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">      commandArr <span class="token operator">=</span> commandArr<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>cmdInfo<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">&#39;cmd&#39;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">      commandArr <span class="token operator">=</span> <span class="token function">unique</span><span class="token punctuation">(</span>commandArr<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line">  <span class="token keyword">return</span> commandArr<span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token comment">//获取文件夹名称</span></span>
<span class="line"><span class="token keyword">function</span> <span class="token function">getDirName</span><span class="token punctuation">(</span><span class="token parameter">entry</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">var</span> lastString <span class="token operator">=</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">var</span> currentString <span class="token operator">=</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">var</span> dirEntryName <span class="token operator">=</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">var</span> lastIndex <span class="token operator">=</span> entry<span class="token punctuation">.</span><span class="token function">lastIndexOf</span><span class="token punctuation">(</span><span class="token string">&#39;/&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  lastString <span class="token operator">=</span> entry<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> lastIndex<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">var</span> currentIndex <span class="token operator">=</span> lastString<span class="token punctuation">.</span><span class="token function">lastIndexOf</span><span class="token punctuation">(</span><span class="token string">&#39;/&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  dirEntryName <span class="token operator">=</span> lastString<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span>currentIndex <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> lastIndex<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">return</span> dirEntryName<span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="配置解析" tabindex="-1"><a class="header-anchor" href="#配置解析"><span>配置解析</span></a></h2><h3 id="entry" tabindex="-1"><a class="header-anchor" href="#entry"><span>entry</span></a></h3><ul><li>入口文件路径</li><li>可以是字符串，可以是数组，可以是对象</li><li>数组指的是两个执行编译，并且代码合并</li></ul><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token comment">// 字符串</span></span>
<span class="line"><span class="token literal-property property">entry</span><span class="token operator">:</span> <span class="token string">&#39;./src/main.js&#39;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 数组（多个文件打包到一起）</span></span>
<span class="line"><span class="token literal-property property">entry</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;babel-polyfill&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;./src/main.js&#39;</span><span class="token punctuation">]</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 对象（多入口）</span></span>
<span class="line"><span class="token literal-property property">entry</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token literal-property property">app</span><span class="token operator">:</span> <span class="token string">&#39;./src/app.js&#39;</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token literal-property property">admin</span><span class="token operator">:</span> <span class="token string">&#39;./src/admin.js&#39;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 对象+数组组合</span></span>
<span class="line"><span class="token literal-property property">entry</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token literal-property property">app</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;babel-polyfill&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;./src/app.js&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token literal-property property">vendors</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;./src/assets/js/lib.js&#39;</span><span class="token punctuation">]</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>当前项目 输出路径：编译整合的当前路径</li><li>entry中的路径不会直接作为输出路径，而是作为下方output中[name]的值</li><li><em><strong>这里只是定义了需要打包的入口文件列表，但是没有定义插入html中的顺序，是在下方的plugins的HtmlWebpackPlugin插件中定义</strong></em></li></ul><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token literal-property property">entry</span><span class="token operator">:</span> Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span>entries<span class="token punctuation">,</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token string-property property">&#39;js/vendors&#39;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;./src/assets/js/lib.js&#39;</span><span class="token punctuation">]</span>  <span class="token comment">// 里面引入的很多第三方库</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token comment">// 实际结果</span></span>
<span class="line"><span class="token literal-property property">entry</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token string-property property">&#39;account/js/account&#39;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;babel-polyfill&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;./src/module/account/account.js&quot;</span><span class="token punctuation">]</span></span>
<span class="line">    <span class="token string-property property">&#39;js/vendors&#39;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;./src/assets/js/lib.js&#39;</span><span class="token punctuation">]</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="output" tabindex="-1"><a class="header-anchor" href="#output"><span>output</span></a></h3><ul><li>输出文件路径</li><li>path.resolve() - Node.js path模块的方法，用于将路径片段解析为绝对路径</li><li>__dirname - Node.js全局变量，表示当前执行脚本所在的目录的绝对路径</li><li>&#39;../dist&#39; - 相对路径，表示上一级目录下的dist文件夹</li><li>使用path.resolve是需要自动处理Windows和Unix系统的路径分隔符差异，避免路径拼接错误，确保总是得到完整的绝对路径</li><li>filename 定义入口 chunk 的文件名格式，</li><li>chunkFilename - 非入口 chunk 文件名，通过 import() 动态导入的模块，通过 require.ensure() 分割的代码，CommonsChunkPlugin 提取的公共 chunk</li><li>publicPath：(&quot;./&quot;, &#39;/&#39;)定义webpack打包替换引用使用什么替换（入口文件为源头的所有引用这两个方式差别不大）</li><li>所有的引用webpack都会有映射表，最后输出之后都会依赖映射替换资源引用路径，绝对路径和相对路径不都应该没问题吗？ <ul><li>映射替换资源：绝对路劲（从配置的输出地址来替换资源地址），相对路径（从当前引用文件的路径来替换地址）</li><li>因为浏览器访问html的问题</li><li>如果是根路径访问html，那么两种资源请求都没问题</li><li>但是如果nginx做了转发并且一个端口需要对应多个项目（下方案例）</li><li>绝对路劲：只有配置/app/ /admin/ 这些才没问题；相对路径：也没问题</li></ul></li><li>那是不是相对路径就没问题了 <ul><li>不是的，反而考虑的更多了：需要考虑base标签影响、需要考虑路由配置、需要考虑资源加载器行为</li></ul></li></ul><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token literal-property property">output</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token literal-property property">path</span><span class="token operator">:</span> config<span class="token punctuation">.</span>build<span class="token punctuation">.</span>assetsRoot<span class="token punctuation">,</span>   <span class="token comment">// path.resolve(__dirname, &#39;../dist&#39;)</span></span>
<span class="line">    <span class="token literal-property property">filename</span><span class="token operator">:</span> <span class="token string">&#39;[name].js&#39;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">chunkFilename</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">&#39;js/[name].chunk.js&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">publicPath</span><span class="token operator">:</span> <span class="token string">&#39;/&#39;</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token comment">// 应用A</span></span>
<span class="line">location <span class="token operator">/</span>app<span class="token operator">/</span> <span class="token punctuation">{</span></span>
<span class="line">    alias <span class="token operator">/</span><span class="token keyword">var</span><span class="token operator">/</span>www<span class="token operator">/</span>app<span class="token operator">-</span>dist<span class="token operator">/</span><span class="token punctuation">;</span></span>
<span class="line">    try_files $uri $uri<span class="token operator">/</span> <span class="token operator">/</span>app<span class="token operator">/</span>index<span class="token punctuation">.</span>html<span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 应用B  </span></span>
<span class="line">location <span class="token operator">/</span>admin<span class="token operator">/</span> <span class="token punctuation">{</span></span>
<span class="line">    alias <span class="token operator">/</span><span class="token keyword">var</span><span class="token operator">/</span>www<span class="token operator">/</span>admin<span class="token operator">-</span>dist<span class="token operator">/</span><span class="token punctuation">;</span></span>
<span class="line">    try_files $uri $uri<span class="token operator">/</span> <span class="token operator">/</span>admin<span class="token operator">/</span>index<span class="token punctuation">.</span>html<span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 静态资源（如果共享）</span></span>
<span class="line">location <span class="token operator">/</span>shared<span class="token operator">/</span> <span class="token punctuation">{</span></span>
<span class="line">    alias <span class="token operator">/</span><span class="token keyword">var</span><span class="token operator">/</span>www<span class="token operator">/</span>shared<span class="token operator">/</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="遇到import命令执行打包逻辑" tabindex="-1"><a class="header-anchor" href="#遇到import命令执行打包逻辑"><span>遇到import命令执行打包逻辑</span></a></h4><ul><li>代码转换：Webpack会将动态import()语句转换为使用其运行时API的代码（如__webpack_require__.e）</li><li>生成映射关系：运行时内部维护了一个chunk映射表，将你在import()中通过/* webpackChunkName: &quot;xxx&quot; */指定的块名（或自动生成的ID）与最终输出的文件名关联起来</li><li>自动替换路径：当需要加载这个异步chunk时，运行时会根据这个映射表，自动构造正确的请求路径（由output.publicPath和最终的chunkFilename拼接而成）去加载这个文件</li></ul><h3 id="resolve" tabindex="-1"><a class="header-anchor" href="#resolve"><span>resolve</span></a></h3><ul><li>Webpack 的 模块解析配置，用于告诉 Webpack 如何查找和解析模块</li><li>extensions：需要识别解析的扩展名</li><li>alias：就是你业务逻辑如果这么写import App from &#39;@/App.vue&#39;; webpack打包时会从这个路径找：src/App.vue</li><li>import Vue from &#39;vue&#39;; 找的是vue/dist/vue.esm.js</li></ul><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token literal-property property">resolve</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token literal-property property">extensions</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;.js&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;.vue&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;.json&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">alias</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token string-property property">&#39;vue$&#39;</span><span class="token operator">:</span> <span class="token string">&#39;vue/dist/vue.esm.js&#39;</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token string-property property">&#39;@&#39;</span><span class="token operator">:</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">&#39;src&#39;</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="plugins" tabindex="-1"><a class="header-anchor" href="#plugins"><span>plugins</span></a></h3><ul><li>插件,影响整个构建过程，优化包、资源管理、环境变量注入等</li><li>ProvidePlugin: 自动加载模块，并将导出值注入为全局变量</li><li>DefinePlugin: 在编译时创建全局常量，通常用于环境变量</li><li>HotModuleReplacementPlugin: 启用热更新（HMR），这个插件会将HMR Runtime注入到浏览器将要执行的JavaScript文件中（例如bundle.js）。这个Runtime就像是浏览器里的一位&quot;模块管理员&quot;，它提供了接收新模块和替换旧模块的基本能力。没有它，客户端就不知道如何进行热更新,</li><li>而前面的webpack-hot-middleware，实现浏览器与服务器实时通信,没有这个HotModuleReplacementPlugin不知道要更新什么</li><li>NoEmitOnErrorsPlugin 错误时不输出文件，避免生成不完整的打包文件</li><li>HtmlWebpackPlugin - 以当前目录下的index.html为模板，插入打包后的js文件引用，输出output.path/[filename]文件</li><li>FriendlyErrorsPlugin 更清晰、更友好的错误提示</li></ul><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line">  <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span></span>
<span class="line">    <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>ProvidePlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">      <span class="token string-property property">&quot;_&quot;</span><span class="token operator">:</span> <span class="token string">&quot;underscore&quot;</span><span class="token punctuation">,</span>   <span class="token comment">// 等价于webpack帮你 var _ = require(&#39;underscore&#39;);</span></span>
<span class="line">      <span class="token string-property property">&quot;$&quot;</span><span class="token operator">:</span> <span class="token string">&quot;jquery&quot;</span>  <span class="token comment">// var $ = require(&#39;jquery&#39;);</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">    </span>
<span class="line">    <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>DefinePlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">      <span class="token string-property property">&#39;process.env&#39;</span><span class="token operator">:</span> config<span class="token punctuation">.</span>dev<span class="token punctuation">.</span>env</span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token comment">// https://github.com/glenjamin/webpack-hot-middleware#installation--usage</span></span>
<span class="line">    <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>HotModuleReplacementPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>NoEmitOnErrorsPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token comment">// https://github.com/ampedandwired/html-webpack-plugin</span></span>
<span class="line">    <span class="token keyword">new</span> <span class="token class-name">HtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">      <span class="token literal-property property">filename</span><span class="token operator">:</span> <span class="token string">&#39;index.html&#39;</span><span class="token punctuation">,</span>  <span class="token comment">// 输出文件名</span></span>
<span class="line">      <span class="token literal-property property">template</span><span class="token operator">:</span> <span class="token string">&#39;index.html&#39;</span><span class="token punctuation">,</span>  <span class="token comment">// 模板文件</span></span>
<span class="line">      <span class="token literal-property property">inject</span><span class="token operator">:</span> <span class="token boolean">true</span>             <span class="token comment">// 自动注入JS/CSS资源</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token keyword">new</span> <span class="token class-name">FriendlyErrorsPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">]</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="动态添加插件" tabindex="-1"><a class="header-anchor" href="#动态添加插件"><span>动态添加插件</span></a></h4><ul><li>plugins.push(new HtmlWebpackPlugin(conf))</li><li>getEntry将符合[&#39;./src/module/<em>.html&#39;,&#39;./src/module/**/</em>.html&#39;]规则的html路径转化成对象</li><li>&#39;./src/module/**/*.html&#39;转化为 moduleName/html文件名: 当前html的路径</li><li>&#39;./src/module/*.html&#39;转化为 html文件名: 当前html的路径</li><li>这里又重新定义了filename、template、inject，所以上面的被覆盖了，所以现在配置意思是以<strong>当前html的路径文件</strong>为模板打包添加js引用，输出到 出口文件夹下/moduleName/html文件名 或者 出口文件夹下/html文件名</li><li>接下来是定义js插入顺序，获取到入口文件列表，获取到业务逻辑js(靠moduleName找到),然后加上&#39;js/vendors&#39;组合成一个数组</li><li>order2 - order1降序插入，先插第三方插件vendors，在插入业务逻辑js</li></ul><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token literal-property property">entry</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token string-property property">&#39;account/js/account&#39;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;babel-polyfill&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;./src/module/account/account.js&quot;</span><span class="token punctuation">]</span></span>
<span class="line">    <span class="token string-property property">&#39;js/vendors&#39;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;./src/assets/js/lib.js&#39;</span><span class="token punctuation">]</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line">conf<span class="token punctuation">.</span>chunks <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&#39;account/js/account&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;js/vendors&#39;</span><span class="token punctuation">]</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">var</span> pages <span class="token operator">=</span> <span class="token function">getEntry</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&#39;./src/module/*.html&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;./src/module/**/*.html&#39;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> pathname <span class="token keyword">in</span> pages<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token comment">// 配置生成的html文件，定义路径等</span></span>
<span class="line">  <span class="token keyword">var</span> conf <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token literal-property property">filename</span><span class="token operator">:</span>  pathname<span class="token operator">+</span><span class="token string">&#39;.html&#39;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">template</span><span class="token operator">:</span> pages<span class="token punctuation">[</span>pathname<span class="token punctuation">]</span><span class="token punctuation">,</span>   <span class="token comment">// 模板路径</span></span>
<span class="line">    <span class="token literal-property property">inject</span><span class="token operator">:</span> <span class="token boolean">true</span>              <span class="token comment">// js插入位置</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">  <span class="token keyword">var</span> moduleType<span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">if</span> <span class="token punctuation">(</span>pathname<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&#39;/&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">var</span> tmp <span class="token operator">=</span> pathname<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&#39;/&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    moduleType <span class="token operator">=</span> tmp<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    moduleType <span class="token operator">=</span> moduleType<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">&#39;&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line">  <span class="token keyword">else</span></span>
<span class="line">    moduleType <span class="token operator">=</span> pathname<span class="token punctuation">;</span></span>
<span class="line">  <span class="token comment">// 定义js插入顺序</span></span>
<span class="line">  <span class="token keyword">var</span> find <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">var</span> key <span class="token keyword">in</span> module<span class="token punctuation">.</span>exports<span class="token punctuation">.</span>entry<span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">var</span> keyValue<span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>key<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&#39;/&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token keyword">var</span> tmp <span class="token operator">=</span> key<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&#39;/&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">      keyValue <span class="token operator">=</span> tmp<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">      keyValue <span class="token operator">=</span> keyValue<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">&#39;&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token keyword">else</span></span>
<span class="line">      keyValue <span class="token operator">=</span> key<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">if</span><span class="token punctuation">(</span>keyValue <span class="token operator">==</span> moduleType<span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">{</span></span>
<span class="line">      conf<span class="token punctuation">.</span>chunks <span class="token operator">=</span> <span class="token punctuation">[</span>key<span class="token punctuation">,</span> <span class="token string">&#39;js/vendors&#39;</span><span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line">      conf<span class="token punctuation">.</span>hash <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span></span>
<span class="line">      find <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span></span>
<span class="line">      conf<span class="token punctuation">[</span><span class="token string">&#39;chunksSortMode&#39;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">chunk1<span class="token punctuation">,</span> chunk2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">var</span> order <span class="token operator">=</span> <span class="token punctuation">[</span>key<span class="token punctuation">,</span> <span class="token string">&#39;js/vendors&#39;</span><span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">var</span> order1 <span class="token operator">=</span> order<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>chunk1<span class="token punctuation">.</span>names<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">var</span> order2 <span class="token operator">=</span> order<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>chunk2<span class="token punctuation">.</span>names<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">return</span> order2 <span class="token operator">-</span> order1<span class="token punctuation">;</span></span>
<span class="line">      <span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line">      <span class="token keyword">break</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line">  <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>find<span class="token punctuation">)</span></span>
<span class="line">    conf<span class="token punctuation">.</span>chunks <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">  module<span class="token punctuation">.</span>exports<span class="token punctuation">.</span>plugins<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">HtmlWebpackPlugin</span><span class="token punctuation">(</span>conf<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token keyword">function</span> <span class="token function">getEntry</span><span class="token punctuation">(</span><span class="token parameter">globPath</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">var</span> entries <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">    basename<span class="token punctuation">,</span> tmp<span class="token punctuation">,</span> pathname<span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> <span class="token punctuation">(</span>globPath<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token string">&quot;object&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    globPath <span class="token operator">=</span> <span class="token punctuation">[</span>globPath<span class="token punctuation">]</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line">  globPath<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">itemPath</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    glob<span class="token punctuation">.</span><span class="token function">sync</span><span class="token punctuation">(</span>itemPath<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">entry</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">      basename <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">basename</span><span class="token punctuation">(</span>entry<span class="token punctuation">,</span> path<span class="token punctuation">.</span><span class="token function">extname</span><span class="token punctuation">(</span>entry<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">      <span class="token keyword">if</span> <span class="token punctuation">(</span>entry<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&#39;/&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        tmp <span class="token operator">=</span> entry<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&#39;/&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        pathname <span class="token operator">=</span> tmp<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&#39;/&#39;</span> <span class="token operator">+</span> basename<span class="token punctuation">;</span> <span class="token comment">// 正确输出js和html的路径</span></span>
<span class="line"></span>
<span class="line">        entries<span class="token punctuation">[</span>pathname<span class="token punctuation">]</span> <span class="token operator">=</span> entry<span class="token punctuation">;</span></span>
<span class="line">      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">        entries<span class="token punctuation">[</span>basename<span class="token punctuation">]</span> <span class="token operator">=</span> entry<span class="token punctuation">;</span></span>
<span class="line">      <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">return</span> entries<span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="module" tabindex="-1"><a class="header-anchor" href="#module"><span>module</span></a></h3><h4 id="rules" tabindex="-1"><a class="header-anchor" href="#rules"><span>rules</span></a></h4><blockquote><p>从入口文件为源头遇到的引用资源根据后缀执行对应的打包规则，以及一系列改名、压缩等等</p></blockquote><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"></span>
<span class="line"><span class="token keyword">function</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token parameter">dir</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">return</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&#39;..&#39;</span><span class="token punctuation">,</span> dir<span class="token punctuation">)</span>   <span class="token comment">// 上一级的传入目录装换为绝对路径</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token literal-property property">module</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token literal-property property">rules</span><span class="token operator">:</span> <span class="token punctuation">[</span></span>
<span class="line">      <span class="token comment">/*  {                                               // 代码质量检查</span>
<span class="line">       test: /\.(js|vue)$/,                               // 匹配js和vue文件</span>
<span class="line">       loader: &#39;eslint-loader&#39;,                           // 使用eslint-loader</span>
<span class="line">       enforce: &quot;pre&quot;,                                    // 预处理，在其他loader之前执行</span>
<span class="line">       include: [resolve(&#39;src&#39;), resolve(&#39;test&#39;)],        // 只检查src和test目录</span>
<span class="line">       options: {</span>
<span class="line">       formatter: require(&#39;eslint-friendly-formatter&#39;)    // 友好的错误格式</span>
<span class="line">       }</span>
<span class="line">       },*/</span></span>
<span class="line">      <span class="token punctuation">{</span>                                                   <span class="token comment">// 处理Vue单文件组件</span></span>
<span class="line">        <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.vue$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>                                   <span class="token comment">// 匹配.vue文件</span></span>
<span class="line">        <span class="token literal-property property">loader</span><span class="token operator">:</span> <span class="token string">&#39;vue-loader&#39;</span><span class="token punctuation">,</span>                             <span class="token comment">// 使用vue-loader</span></span>
<span class="line">        <span class="token literal-property property">options</span><span class="token operator">:</span> vueLoaderConfig                          <span class="token comment">// 独立的vue-loader配置</span></span>
<span class="line">      <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token punctuation">{</span>                                                   <span class="token comment">// 将ES6+代码转译为浏览器兼容的ES5代码</span></span>
<span class="line">        <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.js$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>                                    <span class="token comment">// 匹配.js文件</span></span>
<span class="line">        <span class="token literal-property property">loader</span><span class="token operator">:</span> <span class="token string">&#39;babel-loader&#39;</span><span class="token punctuation">,</span>                           <span class="token comment">// 使用babel-loader转译ES6+</span></span>
<span class="line">        <span class="token literal-property property">include</span><span class="token operator">:</span> <span class="token punctuation">[</span>                                        <span class="token comment">// 只处理以下目录的js文件</span></span>
<span class="line">          <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">&#39;src&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                                 <span class="token comment">// 源码目录</span></span>
<span class="line">          <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">&#39;test&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                                <span class="token comment">// 测试目录</span></span>
<span class="line">          <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">&#39;node_modules/crypto-js&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>              <span class="token comment">// 特殊处理的npm包</span></span>
<span class="line">          <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">&#39;node_modules/vue-awesome-picker&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">          <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">&#39;node_modules/dompurify&#39;</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token punctuation">]</span></span>
<span class="line">      <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token punctuation">{</span>                                                   <span class="token comment">// 小图片转为base64内联，减少HTTP请求, 大图片作为独立文件输出</span></span>
<span class="line">        <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.(png|jpe?g|gif|svg)(\?.*)?$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>            <span class="token comment">// 匹配图片文件</span></span>
<span class="line">        <span class="token literal-property property">loader</span><span class="token operator">:</span> <span class="token string">&#39;url-loader&#39;</span><span class="token punctuation">,</span>                             <span class="token comment">// 使用url-loader</span></span>
<span class="line">        <span class="token literal-property property">query</span><span class="token operator">:</span> <span class="token punctuation">{</span>                                          <span class="token comment">// loader参数</span></span>
<span class="line">          <span class="token literal-property property">limit</span><span class="token operator">:</span> <span class="token number">10000</span><span class="token punctuation">,</span>                                   <span class="token comment">// 小于10KB的图片转为base64</span></span>
<span class="line">          <span class="token literal-property property">publicPath</span><span class="token operator">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">===</span> <span class="token string">&#39;production&#39;</span> <span class="token operator">?</span> config<span class="token punctuation">.</span>build<span class="token punctuation">.</span>assetsPublicPath <span class="token operator">:</span> config<span class="token punctuation">.</span>dev<span class="token punctuation">.</span>assetsPublicPath<span class="token punctuation">,</span></span>
<span class="line">          <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;images/[name].[hash:7].[ext]&#39;</span>            <span class="token comment">// 输出路径和文件名格式</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">      <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token punctuation">{</span>                                                   <span class="token comment">// 处理字体文件，优化策略与图片类似</span></span>
<span class="line">        <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.(woff2?|eot|ttf|otf)(\?.*)?$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>           <span class="token comment">// 匹配字体文件</span></span>
<span class="line">        <span class="token literal-property property">loader</span><span class="token operator">:</span> <span class="token string">&#39;url-loader&#39;</span><span class="token punctuation">,</span>                             <span class="token comment">// 使用url-loader</span></span>
<span class="line">        <span class="token literal-property property">query</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">          <span class="token literal-property property">limit</span><span class="token operator">:</span> <span class="token number">10000</span><span class="token punctuation">,</span>                                    <span class="token comment">// 小于10KB的字体转为base64</span></span>
<span class="line">          <span class="token literal-property property">publicPath</span><span class="token operator">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">===</span> <span class="token string">&#39;production&#39;</span> <span class="token operator">?</span> config<span class="token punctuation">.</span>build<span class="token punctuation">.</span>assetsPublicPath <span class="token operator">:</span> config<span class="token punctuation">.</span>dev<span class="token punctuation">.</span>assetsPublicPath<span class="token punctuation">,</span></span>
<span class="line">          <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;fonts/[name].[hash:7].[ext]&#39;</span>              <span class="token comment">// 输出到fonts目录</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">      <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">]</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="vue编译规则" tabindex="-1"><a class="header-anchor" href="#vue编译规则"><span>vue编译规则</span></a></h5><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"></span>
<span class="line"><span class="token keyword">var</span> vueLoaderConfig <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;./vue-loader.conf&#39;</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token punctuation">[</span><span class="token punctuation">{</span>                                                   <span class="token comment">// 处理Vue单文件组件</span></span>
<span class="line">  <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.vue$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>                                   <span class="token comment">// 匹配.vue文件</span></span>
<span class="line">  <span class="token literal-property property">loader</span><span class="token operator">:</span> <span class="token string">&#39;vue-loader&#39;</span><span class="token punctuation">,</span>                             <span class="token comment">// 使用vue-loader</span></span>
<span class="line">  <span class="token literal-property property">options</span><span class="token operator">:</span> vueLoaderConfig                          <span class="token comment">// 独立的vue-loader配置</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token comment">// vue-loader.conf</span></span>
<span class="line"><span class="token keyword">var</span> utils <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;./utils&#39;</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">var</span> config <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;../config&#39;</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">var</span> isProduction <span class="token operator">=</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">===</span> <span class="token string">&#39;production&#39;</span></span>
<span class="line"></span>
<span class="line">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token literal-property property">loaders</span><span class="token operator">:</span> utils<span class="token punctuation">.</span><span class="token function">cssLoaders</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">    <span class="token literal-property property">sourceMap</span><span class="token operator">:</span> isProduction</span>
<span class="line">      <span class="token operator">?</span> config<span class="token punctuation">.</span>build<span class="token punctuation">.</span>productionSourceMap</span>
<span class="line">      <span class="token operator">:</span> config<span class="token punctuation">.</span>dev<span class="token punctuation">.</span>cssSourceMap<span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">extract</span><span class="token operator">:</span> isProduction</span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// utils.js</span></span>
<span class="line"><span class="token keyword">var</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;path&#39;</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">var</span> config <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;../config&#39;</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">var</span> ExtractTextPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;extract-text-webpack-plugin&#39;</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">exports<span class="token punctuation">.</span><span class="token function-variable function">assetsPath</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">_path</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">var</span> assetsSubDirectory <span class="token operator">=</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">===</span> <span class="token string">&#39;production&#39;</span></span>
<span class="line">    <span class="token operator">?</span> config<span class="token punctuation">.</span>build<span class="token punctuation">.</span>assetsSubDirectory</span>
<span class="line">    <span class="token operator">:</span> config<span class="token punctuation">.</span>dev<span class="token punctuation">.</span>assetsSubDirectory</span>
<span class="line">  <span class="token keyword">return</span> path<span class="token punctuation">.</span>posix<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>assetsSubDirectory<span class="token punctuation">,</span> _path<span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">exports<span class="token punctuation">.</span><span class="token function-variable function">cssLoaders</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  options <span class="token operator">=</span> options <span class="token operator">||</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">  <span class="token keyword">var</span> cssLoader <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token literal-property property">loader</span><span class="token operator">:</span> <span class="token string">&#39;css-loader&#39;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">options</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token literal-property property">minimize</span><span class="token operator">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">===</span> <span class="token string">&#39;production&#39;</span><span class="token punctuation">,</span>                      <span class="token comment">// 生产环境压缩CSS</span></span>
<span class="line">      <span class="token literal-property property">sourceMap</span><span class="token operator">:</span> options<span class="token punctuation">.</span>sourceMap                                          <span class="token comment">// 根据参数启用sourceMap</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">  <span class="token comment">// generate loader string to be used with extract text plugin</span></span>
<span class="line">  <span class="token keyword">function</span> <span class="token function">generateLoaders</span> <span class="token punctuation">(</span><span class="token parameter">loader<span class="token punctuation">,</span> loaderOptions</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                        <span class="token comment">// 生成各种CSS预处理器loader配置</span></span>
<span class="line">    <span class="token keyword">var</span> loaders <span class="token operator">=</span> <span class="token punctuation">[</span>cssLoader<span class="token punctuation">]</span>                                               <span class="token comment">// 基础css-loader</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>loader<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">      loaders<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>                                                        <span class="token comment">// 添加预处理器loader（如less、sass等）</span></span>
<span class="line">        <span class="token literal-property property">loader</span><span class="token operator">:</span> loader <span class="token operator">+</span> <span class="token string">&#39;-loader&#39;</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token literal-property property">options</span><span class="token operator">:</span> Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> loaderOptions<span class="token punctuation">,</span> <span class="token punctuation">{</span></span>
<span class="line">          <span class="token literal-property property">sourceMap</span><span class="token operator">:</span> options<span class="token punctuation">.</span>sourceMap</span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">      <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment">// Extract CSS when that option is specified</span></span>
<span class="line">    <span class="token comment">// (which is the case during production build)</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>options<span class="token punctuation">.</span>extract<span class="token punctuation">)</span> <span class="token punctuation">{</span>                                                  <span class="token comment">// 根据环境返回不同的loader配置</span></span>
<span class="line">      <span class="token keyword">return</span> ExtractTextPlugin<span class="token punctuation">.</span><span class="token function">extract</span><span class="token punctuation">(</span><span class="token punctuation">{</span>                                    <span class="token comment">// 生产环境：提取CSS到独立文件</span></span>
<span class="line">        <span class="token literal-property property">use</span><span class="token operator">:</span> loaders<span class="token punctuation">,</span></span>
<span class="line">        <span class="token literal-property property">fallback</span><span class="token operator">:</span> <span class="token string">&#39;vue-style-loader&#39;</span></span>
<span class="line">      <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token string">&#39;vue-style-loader&#39;</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>loaders<span class="token punctuation">)</span>                           <span class="token comment">// 开发环境：CSS内联在JS中，支持热重载</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">  <span class="token comment">// http://vuejs.github.io/vue-loader/en/configurations/extract-css.html</span></span>
<span class="line">  <span class="token keyword">return</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token literal-property property">css</span><span class="token operator">:</span> <span class="token function">generateLoaders</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                                                 <span class="token comment">// 普通CSS</span></span>
<span class="line">    <span class="token literal-property property">postcss</span><span class="token operator">:</span> <span class="token function">generateLoaders</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                                             <span class="token comment">// PostCSS</span></span>
<span class="line">    <span class="token literal-property property">less</span><span class="token operator">:</span> <span class="token function">generateLoaders</span><span class="token punctuation">(</span><span class="token string">&#39;less&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                                          <span class="token comment">// Less</span></span>
<span class="line">    <span class="token literal-property property">sass</span><span class="token operator">:</span> <span class="token function">generateLoaders</span><span class="token punctuation">(</span><span class="token string">&#39;sass&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">indentedSyntax</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                <span class="token comment">// Sass(缩进语法)</span></span>
<span class="line">    <span class="token literal-property property">scss</span><span class="token operator">:</span> <span class="token function">generateLoaders</span><span class="token punctuation">(</span><span class="token string">&#39;sass&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                                          <span class="token comment">// Scss</span></span>
<span class="line">    <span class="token literal-property property">stylus</span><span class="token operator">:</span> <span class="token function">generateLoaders</span><span class="token punctuation">(</span><span class="token string">&#39;stylus&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                                      <span class="token comment">// Stylus</span></span>
<span class="line">    <span class="token literal-property property">styl</span><span class="token operator">:</span> <span class="token function">generateLoaders</span><span class="token punctuation">(</span><span class="token string">&#39;stylus&#39;</span><span class="token punctuation">)</span>                                         <span class="token comment">// Stylus别名</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// Generate loaders for standalone style files (outside of .vue)</span></span>
<span class="line">exports<span class="token punctuation">.</span><span class="token function-variable function">styleLoaders</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">var</span> output <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span></span>
<span class="line">  <span class="token keyword">var</span> loaders <span class="token operator">=</span> exports<span class="token punctuation">.</span><span class="token function">cssLoaders</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span></span>
<span class="line">  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> extension <span class="token keyword">in</span> loaders<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">var</span> loader <span class="token operator">=</span> loaders<span class="token punctuation">[</span>extension<span class="token punctuation">]</span></span>
<span class="line">    output<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">      <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">RegExp</span><span class="token punctuation">(</span><span class="token string">&#39;\\.&#39;</span> <span class="token operator">+</span> extension <span class="token operator">+</span> <span class="token string">&#39;$&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token literal-property property">use</span><span class="token operator">:</span> loader</span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line">  <span class="token keyword">return</span> output</span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="一些问题" tabindex="-1"><a class="header-anchor" href="#一些问题"><span>一些问题</span></a></h3><blockquote><p>webpack没有对scss进行编译，是gulp dev执行的scss编译，但是生成的css文件传输写入到static下面css文件夹了，为什么浏览器打开的页面能加载到css</p></blockquote><ul><li>webpack是从入口js文件开始执行编译，但是scss没有在js里引入，也没在vue的style里面引入，所以webpack做不到scss编译</li><li>查看发现：HtmlWebpackPlugin定义的模板html文件在开发时已经加上<link href="../css/pbApp.css" rel="stylesheet"><link href="../css/account.css" rel="stylesheet">了</li><li>pbApp 是 /themes/_default.scss + 三方或者公共 vendors/index.scss 合并编译压缩出来的</li><li>account 是 /themes/_default.scss + 业务代码 modules/${moduleName}.scss 合并编译压缩出来的</li><li>按照模板打包html基本只是做了出口js文件资源的插入，所以css引入是有了，但是webpack没有从static中把css文件复制到dist（出口文件夹）啊，浏览器为什么可以正确访问到的呢</li><li>其实访问服务器根目录不是只指向了（dist）出口文件夹，staticPath = &#39;/&#39;;app.use(staticPath, express.static(&#39;static&#39;))；这行代码也定义了一个根目录地址</li><li>所以 127.0.0.1:3000/css/account.css 不只从 dist/css/account.css找，还会从static/css/account.css查找；</li></ul></div><!--[--><!--]--></div><footer class="vp-page-meta"><!----><div class="vp-meta-item git-info"><!----><!----></div></footer><!----><!--[--><!--]--></main><!--]--></div><!--[--><!----><!--]--><!--]--></div>
    <script type="module" src="/assets/app-34Y0emjC.js" defer></script>
  </body>
</html>
