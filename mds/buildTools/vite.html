<!doctype html>
<html lang="en-US">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.26" />
    <style>
      :root {
        --vp-c-bg: #fff;
      }

      [data-theme='dark'] {
        --vp-c-bg: #1b1b1f;
      }

      html,
      body {
        background-color: var(--vp-c-bg);
      }
    </style>
    <script>
      const useChoice = localStorage.getItem('vuepress-color-scheme')
      const systemStatus =
        'matchMedia' in window
          ? window.matchMedia('(prefers-color-scheme: dark)').matches
          : false

      if (useChoice === 'light') {
        document.documentElement.dataset.theme = 'light'
      } else if (useChoice === 'dark' || systemStatus) {
        document.documentElement.dataset.theme = 'dark'
      }
    </script>
    <title>Vite | å‰ç«¯ç¬”è®°</title><meta name="description" content="">
    <link rel="preload" href="/assets/style-C5QREZ3P.css" as="style"><link rel="stylesheet" href="/assets/style-C5QREZ3P.css">
    <link rel="modulepreload" href="/assets/app-D6TqyvMs.js"><link rel="modulepreload" href="/assets/vite.html-CrSzeqR3.js">
    <link rel="prefetch" href="/assets/index.html-BcZd1lvp.js" as="script"><link rel="prefetch" href="/assets/flutter.html-B09vP2oB.js" as="script"><link rel="prefetch" href="/assets/javascript.html-TUHoYsiS.js" as="script"><link rel="prefetch" href="/assets/loginNginx.html-BVywJNyX.js" as="script"><link rel="prefetch" href="/assets/mysql.html-Bcf30ZtN.js" as="script"><link rel="prefetch" href="/assets/nginx.html-128XVq0x.js" as="script"><link rel="prefetch" href="/assets/react.html-BaDBqkrW.js" as="script"><link rel="prefetch" href="/assets/server.html-JgIvPMXH.js" as="script"><link rel="prefetch" href="/assets/gulp.html-J5QChLu9.js" as="script"><link rel="prefetch" href="/assets/npm.html-W-5yHm1N.js" as="script"><link rel="prefetch" href="/assets/webpack-dev-conf.html-Dv_5GTMz.js" as="script"><link rel="prefetch" href="/assets/webpack.html-HRDcK3bw.js" as="script"><link rel="prefetch" href="/assets/brew.html-DSIa35tp.js" as="script"><link rel="prefetch" href="/assets/git.html-BoZqCUHu.js" as="script"><link rel="prefetch" href="/assets/node.html-ChlNFiPz.js" as="script"><link rel="prefetch" href="/assets/nvm.html-DVvFK9OD.js" as="script"><link rel="prefetch" href="/assets/basejieshao.html-Sd0zluD0.js" as="script"><link rel="prefetch" href="/assets/sass.html-9nidoaOD.js" as="script"><link rel="prefetch" href="/assets/vue2.html-CZeVJ9to.js" as="script"><link rel="prefetch" href="/assets/vue2_project.html-DlwYTE0m.js" as="script"><link rel="prefetch" href="/assets/vue2_router.html-RpKMJYMA.js" as="script"><link rel="prefetch" href="/assets/vue2_vuex.html-CSDFLmPe.js" as="script"><link rel="prefetch" href="/assets/vue3.html-CreKIZcH.js" as="script"><link rel="prefetch" href="/assets/AjaxXML.html-ciq0smEM.js" as="script"><link rel="prefetch" href="/assets/asyncawait.html-DtIKP4cH.js" as="script"><link rel="prefetch" href="/assets/crossOrigin.html-1CO4zoNR.js" as="script"><link rel="prefetch" href="/assets/fetch.html-BB4-L1_B.js" as="script"><link rel="prefetch" href="/assets/Generator.html-B_mSiFAj.js" as="script"><link rel="prefetch" href="/assets/packageUpload.html-CGLHFj7u.js" as="script"><link rel="prefetch" href="/assets/Promise.html-vT4nvGPv.js" as="script"><link rel="prefetch" href="/assets/console.html-COTArx2o.js" as="script"><link rel="prefetch" href="/assets/history.html-CLHu8jhg.js" as="script"><link rel="prefetch" href="/assets/location.html-BmGQvwlF.js" as="script"><link rel="prefetch" href="/assets/Navigator.html-WKLP-8hA.js" as="script"><link rel="prefetch" href="/assets/window.html-Bjab9cuA.js" as="script"><link rel="prefetch" href="/assets/anime.html-YJkHvvsW.js" as="script"><link rel="prefetch" href="/assets/baseEvent.html-Bz9gU_DG.js" as="script"><link rel="prefetch" href="/assets/DOM.html-FKuCeGoG.js" as="script"><link rel="prefetch" href="/assets/DOMNode.html-CoHXAfqB.js" as="script"><link rel="prefetch" href="/assets/domPosition.html-CIeCS6mB.js" as="script"><link rel="prefetch" href="/assets/highEvent.html-BgHmp-lK.js" as="script"><link rel="prefetch" href="/assets/localStroge.html-DrzPkZX1.js" as="script"><link rel="prefetch" href="/assets/operaForm.html-DFszINbo.js" as="script"><link rel="prefetch" href="/assets/phoneEvent.html-BfzXsjQY.js" as="script"><link rel="prefetch" href="/assets/arr.html-CBjcjnYT.js" as="script"><link rel="prefetch" href="/assets/debugError.html-D5CWrULl.js" as="script"><link rel="prefetch" href="/assets/Map.html-Do1VFh8c.js" as="script"><link rel="prefetch" href="/assets/phoneDebug.html-Krq9UfI1.js" as="script"><link rel="prefetch" href="/assets/processControl.html-C1pPHcSI.js" as="script"><link rel="prefetch" href="/assets/Set.html-9lVsKrK8.js" as="script"><link rel="prefetch" href="/assets/Symbol.html-qPIExdtd.js" as="script"><link rel="prefetch" href="/assets/transferDataType.html-CtTNwgYw.js" as="script"><link rel="prefetch" href="/assets/var_dateType.html-UFd2wzME.js" as="script"><link rel="prefetch" href="/assets/yunsuanfu.html-Br7YWDRC.js" as="script"><link rel="prefetch" href="/assets/collect.html-C5Zl-xaE.js" as="script"><link rel="prefetch" href="/assets/designMode.html-D-EMGqrC.js" as="script"><link rel="prefetch" href="/assets/moduleDev.html-DhrnizZB.js" as="script"><link rel="prefetch" href="/assets/storage.html-BUzDIVEU.js" as="script"><link rel="prefetch" href="/assets/strict.html-B_kNxRav.js" as="script"><link rel="prefetch" href="/assets/suanfa.html-D94EeJ8C.js" as="script"><link rel="prefetch" href="/assets/webSocket.html-Cx_oZ9q5.js" as="script"><link rel="prefetch" href="/assets/argument_return.html-CpkrXZJE.js" as="script"><link rel="prefetch" href="/assets/highfunc.html-C5Wx-LTa.js" as="script"><link rel="prefetch" href="/assets/varfunc.html-DVQZm8d4.js" as="script"><link rel="prefetch" href="/assets/zuoyongyu.html-ejqbcARi.js" as="script"><link rel="prefetch" href="/assets/Array.html-XEWGRbf0.js" as="script"><link rel="prefetch" href="/assets/Class.html-HqTY595E.js" as="script"><link rel="prefetch" href="/assets/Date.html-yHlGSorm.js" as="script"><link rel="prefetch" href="/assets/faceObjectCode.html-Dz_K20C2.js" as="script"><link rel="prefetch" href="/assets/Math.html-DkgXhtE1.js" as="script"><link rel="prefetch" href="/assets/Object.html-tVF0SArq.js" as="script"><link rel="prefetch" href="/assets/objectbase.html-CKx0EibA.js" as="script"><link rel="prefetch" href="/assets/objectSpecial.html-C-7sOL91.js" as="script"><link rel="prefetch" href="/assets/reg.html-CyGCCaWA.js" as="script"><link rel="prefetch" href="/assets/String.html-XwryKtpd.js" as="script"><link rel="prefetch" href="/assets/404.html-Bx9sDhMU.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><div class="vp-theme-container external-link-icon" vp-container><!--[--><header class="vp-navbar" vp-navbar><div class="vp-toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a class="route-link" href="/"><!----><span class="vp-site-name" aria-hidden="true">å‰ç«¯ç¬”è®°</span></a></span><div class="vp-navbar-items-wrapper" style=""><!--[--><!--]--><!----><!--[--><!--]--><button type="button" class="vp-toggle-color-mode-button" title="toggle color mode"><svg class="light-icon" viewbox="0 0 32 32" style=""><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg class="dark-icon" viewbox="0 0 32 32" style="display:none;"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><!----></div></header><!--]--><div class="vp-sidebar-mask"></div><!--[--><aside class="vp-sidebar" vp-sidebar><!----><!--[--><!--]--><ul class="vp-sidebar-items"><!--[--><li><p tabindex="0" class="vp-sidebar-item vp-sidebar-heading">Vite <!----></p><!----></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="vp-page"><!--[--><!--]--><div vp-content><!--[--><!--]--><div id="content"><h1 id="vite" tabindex="-1"><a class="header-anchor" href="#vite"><span>Vite</span></a></h1><blockquote><p>æ˜¯ä¸€ç§æ–°å‹å‰ç«¯æ„å»ºå·¥å…·ï¼Œèƒ½å¤Ÿæ˜¾è‘—æå‡å‰ç«¯å¼€å‘ä½“éªŒ</p></blockquote><h2 id="éœ€æ±‚" tabindex="-1"><a class="header-anchor" href="#éœ€æ±‚"><span>éœ€æ±‚</span></a></h2><blockquote><p>å»ºä¸€ä¸ªåŒæ—¶æ”¯æŒvue2æŠ€æœ¯æ ˆã€vue3æŠ€æœ¯æ ˆã€reactæŠ€æœ¯æ ˆçš„Monorepoé¡¹ç›®</p></blockquote><ul><li>æ¯ä¸€ä¸­è¯­è¨€æ–‡ä»¶å¤¹ä¸‹modulesä¸‹çš„æ¯ä¸€ä¸ªæ–‡ä»¶å¤¹éƒ½æ˜¯ä¸€ä¸ªå®Œæ•´çš„é¡¹ç›®(å½“å‰é¡¹ç›®çš„è·¯å¾„ã€å½“å‰é¡¹ç›®çš„ç»„ä»¶ã€å½“å‰é¡¹ç›®çš„vuexæˆ–pinia)</li><li>dev serveåªèƒ½è¿è¡Œä¸€ä¸ªæ–‡ä»¶å¤¹ä¸‹çš„å…¥å£ts</li><li>ç”±äºviteå¯¹åº”ä¸åŒè¯­è¨€æœ‰ä¸åŒçš„æ’ä»¶ï¼Œå¹¶ä¸”ä¸æ˜¯ä¸€ä¸ªå…¥å£æ–‡ä»¶ç”Ÿæˆä¸€ä¸ªviteé…ç½®ï¼Œè€Œæ˜¯æ‰€æœ‰å…¥å£æ–‡ä»¶æ‰§è¡Œä¸€ä¸ªé…ç½®ï¼Œæ‰€ä»¥æ¯æ¬¡buildåªèƒ½åšåˆ°ç¼–è¯‘ä¸€ä¸ªé¡¹ç›®æˆ–è€…ç¼–è¯‘ä¸€ç§è¯­è¨€ä¸‹çš„æ‰€æœ‰é¡¹ç›®ã€‚</li></ul><h2 id="æ”¯æŒå¤šé¡¹ç›®" tabindex="-1"><a class="header-anchor" href="#æ”¯æŒå¤šé¡¹ç›®"><span>æ”¯æŒå¤šé¡¹ç›®</span></a></h2><ul><li>é¡¹ç›®éƒ½æ”¾åœ¨/packages/ç›®å½•ä¸‹</li><li>æ ¹ç›®å½•å¯ä»¥æŒ‰ç…§å…¬å…±ä¾èµ–viteã€tsã€axiosç­‰</li><li>å„ä¸ªé¡¹ç›®å¯ä»¥å»ºç«‹è‡ªå·±çš„package.json,å¹¶ä¸”æŒ‰ç…§è‡ªå·±çš„ä¾èµ–vue@2.7+vue-router/vue@^3+vue-router</li><li>æ ¹ç›®å½•package.jsonè®¾ç½® - npm pnpm cnpm éƒ½ä¼šè¯»å–ä½¿ç”¨ï¼Œä½†æ˜¯ä¸“æ³¨ä½¿ç”¨pnpmä¼šå½±å“æ€§èƒ½</li></ul><div class="language-json line-numbers-mode" data-highlighter="prismjs" data-ext="json"><pre><code class="language-json"><span class="line"><span class="token punctuation">{</span></span>
<span class="line">    <span class="token property">&quot;workspaces&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span></span>
<span class="line">        <span class="token string">&quot;packages/*&quot;</span></span>
<span class="line">    <span class="token punctuation">]</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>æ–°å»ºpnpm-workspace.yaml</li></ul><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml"><pre><code class="language-yaml"><span class="line"><span class="token key atrule">packages</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token punctuation">-</span> <span class="token string">&quot;packages/*&quot;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="é¡¹ç›®ç›®å½•" tabindex="-1"><a class="header-anchor" href="#é¡¹ç›®ç›®å½•"><span>é¡¹ç›®ç›®å½•</span></a></h2><div class="language-cmd line-numbers-mode" data-highlighter="prismjs" data-ext="cmd"><pre><code class="language-cmd"><span class="line">â”‚  .gitignore</span>
<span class="line">â”‚  index-template.html   // buildå¤šå…¥å£æ¨¡æ¿æ–‡ä»¶</span>
<span class="line">â”‚  index.html            // devå…¥å£æ–‡ä»¶</span>
<span class="line">â”‚  package.json</span>
<span class="line">â”‚  pnpm-lock.yaml</span>
<span class="line">â”‚  pnpm-workspace.yaml</span>
<span class="line">â”‚  vite.config.js        // viteé…ç½®</span>
<span class="line">â”‚</span>
<span class="line">â””â”€packages</span>
<span class="line">    â””â”€vue2</span>
<span class="line">        â”‚  package.json  // vue2å­é¡¹ç›®çš„ä¾èµ–åŒ…æ–‡ä»¶</span>
<span class="line">        â”‚  pnpm-lock.yaml</span>
<span class="line">        â”‚  tsconfig.json // vue2å­é¡¹ç›®çš„tsé…ç½®</span>
<span class="line">        â”‚</span>
<span class="line">        â””â”€modules</span>
<span class="line">            â”‚  shims-vue.d.ts  // tsè¯†åˆ«vueæ–‡ä»¶</span>
<span class="line">            â”‚</span>
<span class="line">            â”œâ”€about</span>
<span class="line">            â”‚      App.vue</span>
<span class="line">            â”‚      index.ts</span>
<span class="line">            â”‚</span>
<span class="line">            â””â”€home</span>
<span class="line">                   App.vue</span>
<span class="line">                   index.ts</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="ä»£ç è§£æ" tabindex="-1"><a class="header-anchor" href="#ä»£ç è§£æ"><span>ä»£ç è§£æ</span></a></h2><h3 id="ä½¿ç”¨defineconfigå‡½æ•°-ä¼ å…¥å‡½æ•°-è¿”å›viteé…ç½®" tabindex="-1"><a class="header-anchor" href="#ä½¿ç”¨defineconfigå‡½æ•°-ä¼ å…¥å‡½æ•°-è¿”å›viteé…ç½®"><span>ä½¿ç”¨defineConfigå‡½æ•°ï¼Œä¼ å…¥å‡½æ•°ï¼Œè¿”å›viteé…ç½®</span></a></h3><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> defineConfig <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;vite&quot;</span>   <span class="token comment">// viteè®¾ç½®é»˜è®¤é…ç½®</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">defineConfig</span><span class="token punctuation">(</span> <span class="token keyword">async</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>command<span class="token punctuation">,</span> mode<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment">// command:æ˜¯å¦æ˜¯å¯åŠ¨æœåŠ¡</span></span>
<span class="line">    <span class="token comment">// mode: å¼€å‘è¿˜æ˜¯ç”Ÿäº§ï¼ˆdevè¿˜æ˜¯proï¼‰</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token comment">// viteæœ€ç»ˆçš„é…ç½®</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="æ ¹æ®ç¯å¢ƒå˜é‡å’Œè¿è¡Œé¡¹ç›®åˆ¤æ–­æ˜¯å¦æ‰§è¡Œ" tabindex="-1"><a class="header-anchor" href="#æ ¹æ®ç¯å¢ƒå˜é‡å’Œè¿è¡Œé¡¹ç›®åˆ¤æ–­æ˜¯å¦æ‰§è¡Œ"><span>æ ¹æ®ç¯å¢ƒå˜é‡å’Œè¿è¡Œé¡¹ç›®åˆ¤æ–­æ˜¯å¦æ‰§è¡Œ</span></a></h3><h4 id="devå¿…é¡»æŒ‡å®šå­˜åœ¨çš„ä¸€ä¸ªé¡¹ç›®ånpm-run-dev-home" tabindex="-1"><a class="header-anchor" href="#devå¿…é¡»æŒ‡å®šå­˜åœ¨çš„ä¸€ä¸ªé¡¹ç›®ånpm-run-dev-home"><span>devå¿…é¡»æŒ‡å®šå­˜åœ¨çš„ä¸€ä¸ªé¡¹ç›®ånpm run dev -- --home</span></a></h4><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">import</span> fg <span class="token keyword">from</span> <span class="token string">&quot;fast-glob&quot;</span>   <span class="token comment">// é€’å½’è¯»å–è·¯å¾„è§„åˆ™ï¼Œè¿”å›è·¯å¾„æ•°ç»„ï¼Œå¯å¼‚æ­¥ï¼Œå¯åŒæ­¥(fg.sync)</span></span>
<span class="line"><span class="token keyword">const</span> langs <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&#39;vue2&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;vue3&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;react&#39;</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// å½“å‰é¡¹ç›®æ”¯æŒçš„è¯­è¨€</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// å°è£…ä¸€ä¸ªæŠ¥é”™å‡½æ•°</span></span>
<span class="line"><span class="token keyword">function</span> <span class="token function">throwError</span><span class="token punctuation">(</span><span class="token parameter">msg</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">\nğŸš¨ [Vite Config] </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>msg<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">\n</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token comment">// // ä½¿ç”¨éé›¶é€€å‡ºç è¡¨ç¤ºå¤±è´¥</span></span>
<span class="line">    process<span class="token punctuation">.</span><span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">defineConfig</span><span class="token punctuation">(</span> <span class="token keyword">async</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>command<span class="token punctuation">,</span> mode<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">let</span> argvs <span class="token operator">=</span> process<span class="token punctuation">.</span>argv<span class="token punctuation">;</span></span>
<span class="line">    <span class="token comment">// å½“å‰é¡¹ç›®moduleä¸‹æ¯ä¸ªæ–‡ä»¶å¤¹éƒ½æ˜¯ä¸€ä¸ªç‹¬ç«‹é¡¹ç›®ï¼Œæ‰€ä»¥å¯åŠ¨å¿…é¡»æŒ‡å®šmoudleï¼Œæ‰§è¡Œnpm run dev -- --home</span></span>
<span class="line">    <span class="token keyword">let</span> last_argv <span class="token operator">=</span> argvs<span class="token punctuation">[</span>argvs<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// process.argvè¿”å›å½“å‰å‘½ä»¤çš„è·¯å¾„æˆ–è€…å‚æ•°ï¼Œä»æœ€åä¸€ä¸ªå…ƒç´ è·å–æ‰“åŒ…æˆ–è€…ç¼–è¯‘çš„moduleName</span></span>
<span class="line">    <span class="token keyword">let</span> moduleName <span class="token operator">=</span> last_argv<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token string">&quot;--&quot;</span><span class="token punctuation">)</span> <span class="token operator">?</span> last_argv<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">^--</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">;</span> <span class="token comment">// å»æ‰--</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>command <span class="token operator">===</span> <span class="token string">&#39;serve&#39;</span> <span class="token operator">&amp;&amp;</span> mode <span class="token operator">===</span> <span class="token string">&#39;development&#39;</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>moduleName<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token function">throwError</span><span class="token punctuation">(</span><span class="token string">&quot;é”™è¯¯ï¼šå¼€å‘ç¯å¢ƒå¯åŠ¨æœåŠ¡å™¨å¿…é¡»æŒ‡å®šæ¨¡å—å¯åŠ¨ï¼Œä¾‹å¦‚ï¼šnpm run dev -- --my&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token keyword">const</span> dirs <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">checkScript</span><span class="token punctuation">(</span>moduleName<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// æ ¡éªŒæ‰§è¡Œçš„å‘½ä»¤æ˜¯å¦æ­£ç¡®</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token comment">// æ ¡éªŒå‘½ä»¤æ‰§è¡Œæ˜¯å¦æ­£ç¡®</span></span>
<span class="line"><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">checkScript</span> <span class="token punctuation">(</span><span class="token parameter">moduleName</span><span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment">// è·å–æ‰€æœ‰å…¥å£tsæ–‡ä»¶ï¼Œå¦‚æœæ‰§è¡Œmoduleï¼Œé‚£å°±å…¨å±€æŸ¥æ‰¾</span></span>
<span class="line">    <span class="token keyword">let</span> dirReg <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&#39;./packages/*/modules/*/index.ts&#39;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token comment">// å¯ä»¥æ˜¯å­—ç¬¦ä¸²ï¼Œæœ€å¥½æ•°ç»„ï¼ŒåæœŸä¸ç¡®å®šä¸€å®šæ˜¯tsåç¼€ï¼Œæ‰€ä»¥å¯èƒ½æœ‰å¤šä¸ªå€¼ï¼›</span></span>
<span class="line">    <span class="token keyword">if</span><span class="token punctuation">(</span>moduleName<span class="token punctuation">)</span> dirReg <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">./packages/*/modules/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>moduleName<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/index.ts</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// æ•°ç»„ï¼šç†ç”±åŒä¸Šï¼›</span></span>
<span class="line">    <span class="token keyword">const</span> dirs <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fg</span><span class="token punctuation">(</span>dirReg<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// è·å–è·¯å¾„åˆ—è¡¨</span></span>
<span class="line">    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>dirs<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">        <span class="token function">throwError</span><span class="token punctuation">(</span><span class="token string">&quot;é”™è¯¯ï¼šæœªæ‰¾åˆ°éœ€è¦æ‰“åŒ…è¿è¡Œçš„æ–‡ä»¶&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token comment">// æ ¹æ®é¡¹ç›®æ”¯æŒè¯­è¨€æ•°ç»„ç”Ÿæˆè¯­è¨€æ­£åˆ™---è¦æ±‚æ¯ä¸ªå­é¡¹ç›®æ–‡ä»¶åå¿…é¡»å¸¦è¯­è¨€å³å¯ä»¥æ˜¯packages/vue2ä¹Ÿå¯ä»¥æ˜¯packages/vue2-xxx,ä¸èƒ½æ˜¯packages/v2(é€»è¾‘ä¸è®¤)</span></span>
<span class="line">    <span class="token keyword">let</span> langReg <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RegExp</span><span class="token punctuation">(</span>langs<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">&quot;|&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>dirs<span class="token punctuation">.</span><span class="token function">every</span><span class="token punctuation">(</span><span class="token parameter">v</span><span class="token operator">=&gt;</span>langReg<span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">        <span class="token function">throwError</span><span class="token punctuation">(</span><span class="token string">&quot;é”™è¯¯ï¼šéœ€è¦æ‰“åŒ…çš„tsæ–‡ä»¶è·¯å¾„æœªå£°æ˜å¼€å‘æ¡†æ¶&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token comment">// æš‚æ²¡æƒ³åˆ°ä¸€æ¬¡buildå¤šç§è¯­è¨€ï¼Œæš‚æ—¶åªå®ç°æ‰“ä¸€æ¬¡</span></span>
<span class="line">    <span class="token comment">// æ ¹æ®æ”¯æŒè¯­è¨€æ•°ç»„ï¼Œç”Ÿæˆæ ¡éªŒè¯­è¨€çš„æ­£åˆ™æ•°ç»„</span></span>
<span class="line">    <span class="token keyword">let</span> langArrReg <span class="token operator">=</span> langs<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">v</span><span class="token operator">=&gt;</span><span class="token keyword">new</span> <span class="token class-name">RegExp</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token comment">// è·å–å½“å‰æ‰€ä»¥å…¥å£æ–‡ä»¶ä½¿ç”¨&#39;,&#39;æ‹¼æ¥çš„å­—ç¬¦ä¸²</span></span>
<span class="line">    <span class="token keyword">let</span> dirstr <span class="token operator">=</span> dirs<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token comment">// ä½¿ç”¨reduceè·å–åˆ°å…¥å£æ–‡ä»¶æ•°ç»„åŒ…å«çš„è¯­è¨€æ•°é‡</span></span>
<span class="line">    <span class="token comment">// 0ä¸ºåˆå§‹å€¼ï¼Œpreä¸ºåˆå§‹å€¼/ä¸Šä¸€æ¬¡è¿”å›çš„å€¼,(pre += (cur.test(dirstr) - 0), pre),&#39;,&#39;è¿æ¥çš„è¡¨è¾¾å¼ï¼Œreturnæœ€åä¸€ä¸ªå€¼ï¼›</span></span>
<span class="line">    <span class="token comment">// (cur.test(dirstr) - 0)  true - 0 = 1;</span></span>
<span class="line">    <span class="token keyword">if</span><span class="token punctuation">(</span>langArrReg<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">pre<span class="token punctuation">,</span> cur</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">(</span>pre <span class="token operator">+=</span> <span class="token punctuation">(</span>cur<span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>dirstr<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> pre<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">        <span class="token function">throwError</span><span class="token punctuation">(</span><span class="token string">&quot;é”™è¯¯ï¼šä¸€æ¬¡åªèƒ½åŒæ—¶æ‰“åŒ…ä¸€ç§è¯­è¨€&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token keyword">return</span> dirs</span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="è¿è¡Œdevæ—¶è‡ªåŠ¨ç»™æ ¹ç›®å½•index-htmlçš„scriptå¼•å…¥æŒ‡å®šmoduleçš„tsæ–‡ä»¶" tabindex="-1"><a class="header-anchor" href="#è¿è¡Œdevæ—¶è‡ªåŠ¨ç»™æ ¹ç›®å½•index-htmlçš„scriptå¼•å…¥æŒ‡å®šmoduleçš„tsæ–‡ä»¶"><span>è¿è¡Œdevæ—¶è‡ªåŠ¨ç»™æ ¹ç›®å½•index.htmlçš„scriptå¼•å…¥æŒ‡å®šmoduleçš„tsæ–‡ä»¶</span></a></h3><ul><li>ä¸å¸Œæœ›å‡ºç°æ–‡ä»¶æ›´æ”¹ï¼Œåšå¥½çš„ç‰ˆæœ¬æ˜¯é€šè¿‡å˜é‡ä¼ é€’</li><li>å˜é‡ä»…å½“å‰è¿›ç¨‹æœ‰æ•ˆ</li></ul><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">defineConfig</span><span class="token punctuation">(</span> <span class="token keyword">async</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>command<span class="token punctuation">,</span> mode<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">if</span><span class="token punctuation">(</span>command <span class="token operator">===</span> <span class="token string">&#39;serve&#39;</span> <span class="token operator">&amp;&amp;</span> mode <span class="token operator">===</span> <span class="token string">&#39;development&#39;</span><span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">        <span class="token comment">// å¦‚æœå¼€å‘ç¯å¢ƒï¼Œè®¾ç½®ç¯å¢ƒå˜é‡ï¼Œç”¨äºä¼ å…¥æ ¹ç›®å½•index.htmlæ–‡ä»¶è¯»å–</span></span>
<span class="line">        <span class="token comment">// å¦‚æœä¸åŒè¯­è¨€æœ‰åŒæ ·çš„moduleName,åªç”¨ç¬¬ä¸€ä¸ªï¼›dirs[0]</span></span>
<span class="line">        <span class="token comment">// ä¸ºäº†é€‚é…windowsæ‰€ä»¥é‡‡ç”¨path.relativeç”Ÿæˆç›¸å¯¹è·¯å¾„</span></span>
<span class="line">        <span class="token comment">// path.resolve---ç”Ÿæˆç»å¯¹è·¯å¾„  E:\02_private_project\vortex-fe\packages\vue2\modules\home\index.ts,è¿™æ˜¯fileåè®®ï¼Œæ²¡æœ‰è®¿é—®æƒé™çš„</span></span>
<span class="line">        process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">VITE_SCRIPT_SRC</span> <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">relative</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> dirs<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token comment">// index.html</span></span>
<span class="line"><span class="token comment">// &lt;script type=&quot;module&quot; src=&quot;%VITE_SCRIPT_SRC%&quot;&gt;&lt;/script&gt;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="è·å–buildæ—¶çš„å¤šå…¥å£æ–‡ä»¶åˆ—è¡¨" tabindex="-1"><a class="header-anchor" href="#è·å–buildæ—¶çš„å¤šå…¥å£æ–‡ä»¶åˆ—è¡¨"><span>è·å–buildæ—¶çš„å¤šå…¥å£æ–‡ä»¶åˆ—è¡¨</span></a></h3><ul><li>viteå…¥å£æ–‡ä»¶æ˜¯index.html,æ”¯æŒå¤šå…¥å£ï¼Œä½†æ˜¯æ”¯æŒçš„ä¹Ÿæ˜¯htmlæ–‡ä»¶</li><li>ä½†æ˜¯æˆ‘ä¸å¸Œæœ›æ¯ä¸ªé¡¹ç›®åˆ›å»ºä¸€ä¸ªhtmlæ–‡ä»¶</li><li>ä½¿ç”¨ä¸€ä¸ªæ–‡ä»¶æ¨¡æ¿ï¼Œè‡ªåŠ¨è®¾ç½®scriptå¼•ç”¨</li><li>è¿™æ–‡ä»¶ä¸è¦å†™å…¥ç£ç›˜ï¼Œå­˜åœ¨å†…å­˜ä¸­</li></ul><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"></span>
<span class="line"><span class="token keyword">import</span> path <span class="token keyword">from</span> <span class="token string">&#39;path&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> fs <span class="token keyword">from</span> <span class="token string">&#39;fs/promises&#39;</span><span class="token punctuation">;</span> <span class="token comment">// ä»éœ€è¯»å–æ¨¡æ¿æ–‡ä»¶</span></span>
<span class="line"><span class="token keyword">const</span> langs <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&#39;vue2&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;vue3&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;react&#39;</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// å½“å‰é¡¹ç›®æ”¯æŒçš„è¯­è¨€</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">const</span> htmlTemplatePath <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&#39;index-template.html&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// buildæ—¶ä½¿ç”¨çš„htmlæ¨¡æ¿</span></span>
<span class="line"><span class="token keyword">const</span> scriptPlaceholder <span class="token operator">=</span> <span class="token string">&#39;&lt;!-- INJECT_SCRIPT --&gt;&#39;</span>    <span class="token comment">// buildæ—¶åŠ¨æ€æ’å…¥scriptæ ‡ç­¾çš„å ä½</span></span>
<span class="line"><span class="token keyword">const</span> generatedEntries <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>        <span class="token comment">// buildç”Ÿæˆè™šæ‹Ÿhtmlçš„åˆ—è¡¨</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">defineConfig</span><span class="token punctuation">(</span> <span class="token keyword">async</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>command<span class="token punctuation">,</span> mode<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">const</span> entries <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">getEntries</span><span class="token punctuation">(</span>dirs<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// è·å–buildæ—¶çš„å…¥å£é…ç½®</span></span>
<span class="line">    <span class="token keyword">let</span> plugins <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token function">VirtualHtmlResolver</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token comment">// è‡ªå®šä¹‰ç»„ä»¶ï¼Œç”¨äºè§£æbuildç”Ÿæˆçš„è™šæ‹Ÿhtml</span></span>
<span class="line">    <span class="token comment">// ...å…¶ä»–å®šåˆ¶æ’ä»¶ã€å…¬å…±æ’ä»¶</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token punctuation">{</span></span>
<span class="line">        plugins<span class="token punctuation">,</span>  <span class="token comment">// æ’ä»¶é…ç½®</span></span>
<span class="line">        <span class="token literal-property property">base</span><span class="token operator">:</span><span class="token string">&quot;./&quot;</span><span class="token punctuation">,</span> <span class="token comment">// ç¼–è¯‘å®Œåæ–‡ä»¶å¼•å…¥çš„æ–¹å¼-ç›¸å¯¹è·¯å¾„</span></span>
<span class="line">        <span class="token literal-property property">build</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token literal-property property">rollupOptions</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">                <span class="token literal-property property">input</span><span class="token operator">:</span> entries  <span class="token comment">// å®šä¹‰buildæ—¶å¤šå…¥å£-è™šæ‹Ÿæ–‡ä»¶</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token literal-property property">resolve</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token literal-property property">alias</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">                <span class="token string-property property">&#39;@packages&#39;</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&quot;packages&quot;</span><span class="token punctuation">)</span>   <span class="token comment">// ä¸ºäº†è§£å†³éƒ¨åˆ†ç³»ç»Ÿä¸‹è·¯å¾„è§£è¯»è®¿é—®ä¸åŒ</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// å‡†å¤‡ç”Ÿæˆè™šæ‹Ÿhtmlç›®å½•åˆ—è¡¨</span></span>
<span class="line"><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">getEntries</span><span class="token punctuation">(</span><span class="token parameter">dirs</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment">// 1. è¯»å–å¹¶ç¼“å­˜ HTML æ¨¡æ¿</span></span>
<span class="line">    <span class="token keyword">let</span> templateContent <span class="token operator">=</span> <span class="token keyword">await</span> fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span>htmlTemplatePath<span class="token punctuation">,</span> <span class="token string">&#39;utf-8&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>templateContent<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>scriptPlaceholder<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        console<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">è­¦å‘Šï¼šHTML æ¨¡æ¿æ–‡ä»¶ </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>htmlTemplatePath<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> ä¸­æœªæ‰¾åˆ°å ä½ç¬¦ &#39;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>scriptPlaceholder<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&#39;ã€‚</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token comment">// å…¥å£æ–‡ä»¶å¯ä»¥æ˜¯ä¸ª string []ï¼Œæ‰€ä»¥è¿™é‡Œç›´æ¥returnäº†ï¼›</span></span>
<span class="line">    <span class="token keyword">return</span> dirs<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">filePath</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">const</span> relativeToPackages <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">relative</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&#39;packages&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> filePath<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token comment">// ä½¿ç”¨posixé£æ ¼ï¼ˆå…¼å®¹ Unix/Linux å’Œ Windowsï¼‰</span></span>
<span class="line">        <span class="token keyword">const</span> tsPath <span class="token operator">=</span> path<span class="token punctuation">.</span>posix<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">&#39;@packages&#39;</span><span class="token punctuation">,</span> relativeToPackages<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">const</span> htmlContent <span class="token operator">=</span> templateContent<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span></span>
<span class="line">            scriptPlaceholder<span class="token punctuation">,</span></span>
<span class="line">            <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&lt;script type=&quot;module&quot; src=&quot;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>tsPath<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&quot;&gt;&lt;/script&gt;</span><span class="token template-punctuation string">`</span></span> <span class="token comment">// ä½¿ç”¨ç»å¯¹è·¯å¾„ / å¼€å¤´æ›´å®‰å…¨</span></span>
<span class="line">        <span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token comment">// path.basename(path[, ext]) ä»ä¸€ä¸ªå®Œæ•´è·¯å¾„ï¼ˆæ— è®ºæ˜¯æ–‡ä»¶è·¯å¾„è¿˜æ˜¯ç›®å½•è·¯å¾„ï¼‰ä¸­æå–å‡ºæœ€åä¸€éƒ¨åˆ†</span></span>
<span class="line">        <span class="token comment">// path.basename(tsPath, path.extname(tsPath)),ä»tsPathè·å–æœ€åä¸€éƒ¨åˆ†å¹¶ä¸”å»é™¤åç¼€åï¼Œè¿™é‡Œçš„ç»“æœæ˜¯index</span></span>
<span class="line">        <span class="token comment">// path.dirname(tsPath)ï¼šè·å–tsPathæ–‡ä»¶æ‰€åœ¨çš„è·¯å¾„ï¼šxxxx/home/index.ts ==&gt; xxxx/home</span></span>
<span class="line">        <span class="token keyword">const</span> dirName <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">dirname</span><span class="token punctuation">(</span>tsPath<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token comment">// xxxx/homeè·å–æœ€åä¸€éƒ¨åˆ†==&gt;home</span></span>
<span class="line">        <span class="token keyword">const</span> tsFileName <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">basename</span><span class="token punctuation">(</span>dirName<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token comment">// æˆ‘è¿™é‡Œæ²¡æœ‰åˆ›å»ºæ–‡ä»¶ï¼Œåªæ˜¯æŠŠæ–‡ä»¶å†…å®¹å­˜åœ¨generatedEntriesé‡Œ</span></span>
<span class="line">        <span class="token comment">// æ€ä¹ˆå®ç°è®©viteè®¤è¯†å‘¢ï¼Ÿï¼Ÿ</span></span>
<span class="line">        <span class="token comment">// ä½¿ç”¨è‡ªå®šä¹‰æ’ä»¶ï¼šç”¨æ—¶é—´é’©å­ï¼Œåœ¨viteè¯»å–åˆ°æˆ‘çš„tsFileNameçš„æ—¶å€™ï¼Œå°†htmlContentåå‡ºå» --- ä¸‹é¢çš„VirtualHtmlResolveræ’ä»¶ï¼›</span></span>
<span class="line">        generatedEntries<span class="token punctuation">[</span>tsFileName<span class="token punctuation">]</span> <span class="token operator">=</span> htmlContent<span class="token punctuation">;</span>  <span class="token comment">// è™šæ‹Ÿåˆ—è¡¨</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>tsFileName<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">.html</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token keyword">function</span> <span class="token function">VirtualHtmlResolver</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;virtual-html-resolver&#39;</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token comment">// resolveId é’©å­ç”¨äºè§£æè™šæ‹Ÿæ¨¡å—ID</span></span>
<span class="line">        <span class="token function">resolveId</span><span class="token punctuation">(</span><span class="token parameter">tsPath</span><span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">            <span class="token keyword">if</span><span class="token punctuation">(</span>generatedEntries<span class="token punctuation">[</span>tsPath<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">                <span class="token keyword">return</span> tsPath<span class="token punctuation">;</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line">            <span class="token keyword">return</span> <span class="token keyword">null</span></span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token comment">// loadè·¯å¾„æ–‡ä»¶æ—¶ï¼Œä»è™šæ‹Ÿåˆ—è¡¨generatedEntriesä¸­è¯»å–returnï¼›</span></span>
<span class="line">        <span class="token function">load</span><span class="token punctuation">(</span><span class="token parameter">tsPath</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token keyword">let</span> tsFileName <span class="token operator">=</span> tsPath<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token keyword">return</span> generatedEntries<span class="token punctuation">[</span>tsFileName<span class="token punctuation">]</span> <span class="token operator">||</span> <span class="token keyword">null</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="é…ç½®å®šåˆ¶æ’ä»¶" tabindex="-1"><a class="header-anchor" href="#é…ç½®å®šåˆ¶æ’ä»¶"><span>é…ç½®å®šåˆ¶æ’ä»¶</span></a></h3><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">import</span> vue2 <span class="token keyword">from</span> <span class="token string">&quot;@vitejs/plugin-vue2&quot;</span>  <span class="token comment">// vue2.7ä½¿ç”¨viteéœ€è¦çš„æ’ä»¶</span></span>
<span class="line"><span class="token comment">// ...å¼•å…¥å…¶ä»–è¯­è¨€çš„å®šåˆ¶æ’ä»¶</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">defineConfig</span><span class="token punctuation">(</span> <span class="token keyword">async</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>command<span class="token punctuation">,</span> mode<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">let</span> plugins <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">...</span><span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token comment">// å…¬å…±æ’ä»¶</span></span>
<span class="line">    plugins <span class="token operator">=</span> <span class="token function">getPlugins</span><span class="token punctuation">(</span>dirs<span class="token punctuation">,</span> plugins<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// å„ä¸ªè¯­è¨€å®šåˆ¶æ’ä»¶</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token operator">...</span><span class="token punctuation">,</span></span>
<span class="line">        plugins</span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token comment">// è·å–æ’ä»¶åˆ—è¡¨</span></span>
<span class="line"><span class="token keyword">function</span> <span class="token function">getPlugins</span> <span class="token punctuation">(</span><span class="token parameter">dirs<span class="token punctuation">,</span> plugins</span><span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">let</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span></span>
<span class="line">    <span class="token comment">// vue2çš„æ’ä»¶</span></span>
<span class="line">    <span class="token keyword">if</span><span class="token punctuation">(</span>dirs<span class="token punctuation">.</span><span class="token function">some</span><span class="token punctuation">(</span><span class="token parameter">v</span><span class="token operator">=&gt;</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">vue2</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">        arr <span class="token operator">=</span> <span class="token punctuation">[</span></span>
<span class="line">            <span class="token function">vue2</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token punctuation">]</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token comment">// vue3çš„æ’ä»¶</span></span>
<span class="line">    <span class="token keyword">if</span><span class="token punctuation">(</span>dirs<span class="token punctuation">.</span><span class="token function">some</span><span class="token punctuation">(</span><span class="token parameter">v</span><span class="token operator">=&gt;</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">vue3</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token comment">// reactçš„æ’ä»¶</span></span>
<span class="line">    <span class="token keyword">if</span><span class="token punctuation">(</span>dirs<span class="token punctuation">.</span><span class="token function">some</span><span class="token punctuation">(</span><span class="token parameter">v</span><span class="token operator">=&gt;</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">react</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    plugins<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token operator">...</span>arr<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">return</span> plugins<span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><!--[--><!--]--></div><footer class="vp-page-meta"><!----><div class="vp-meta-item git-info"><!----><!----></div></footer><!----><!--[--><!--]--></main><!--]--></div><!--[--><!----><!--]--><!--]--></div>
    <script type="module" src="/assets/app-D6TqyvMs.js" defer></script>
  </body>
</html>
